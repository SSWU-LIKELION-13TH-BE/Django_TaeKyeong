<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Posting</title>
</head>
<body>
    <h1>ê²Œì‹œê¸€ ê°œë³„ í˜ì´ì§€</h1>
    <h2>{{post.postname}}</h2>
    <b>ì‘ì„±ì ë‹‰ë„¤ì„ :</b> {{nickname}} <br>
    <b>ì‘ì„±ì techstack :</b> {{post.techstack}} <br>
    <b>ì‘ì„±ì Github :</b> {{post.github}}
    <p>{{post.contents}}</p>

    <!-- ì‚¬ì§„ ì˜ì—­ -->
    {% if post.mainphoto %}
        <img src="{{post.mainphoto.url}}" alt="" width="300">
        <br>
    {% endif %}

    <hr>

    <!-- ì¢‹ì•„ìš” ì˜ì—­ -->
    <form action="{% url 'main:like_post' post.pk %}" method="POST">
        {% csrf_token %}
        {% if user in post.like_users.all %}
          <button type="submit">â¤ï¸ ì¢‹ì•„ìš” ì·¨ì†Œ</button>
        {% else %}
          <button type="submit">ğŸ¤ ì¢‹ì•„ìš”</button>
        {% endif %}
        <span>{{ post.like_users.count }}ëª… ì¢‹ì•„ìš”</span>
    </form>
    <hr>
    <br>
    <a href="/blog/">ëª©ë¡</a>
    <a href="/blog/{{post.pk}}/remove">ì‚­ì œ</a>
    <hr>
    

<!-- ëŒ“ê¸€ ì‘ì„± í¼ -->
{% if user.is_authenticated %}
  <form action="{% url 'main:comments_create' post.pk %}" method="POST">
    {% csrf_token %}
    {{ comment_form }}
    <input type="submit" value="ëŒ“ê¸€ ì‘ì„±">
  </form>
{% else %}
  <a href="/user/login/">[ëŒ“ê¸€ì„ ì‘ì„±í•˜ë ¤ë©´ ë¡œê·¸ì¸í•˜ì„¸ìš”.]</a>
{% endif %}

<hr>
<h3>ëŒ“ê¸€ ëª©ë¡</h3>

<!-- ëŒ“ê¸€ ê°œìˆ˜ í‘œì‹œ -->
{% if comments %}
  <p><b>{{ comments|length }}ê°œì˜ ëŒ“ê¸€ì´ ìˆìŠµë‹ˆë‹¤.</b></p>
{% endif %}

<hr>
<!-- ëŒ“ê¸€ ì¢‹ì•„ìš” ë²„íŠ¼ í…œí”Œë¦¿ì— ì¶”ê°€í•˜ê¸° -->
<ul>
    {% for comment in comments %}
      {% if not comment.parent %}
        <li>
          {{ comment.author.nickname }} - {{ comment.content }}
          <small>(ì‘ì„± ì‹œê°„: {{ comment.created_at|date:"Yë…„ mì›” dì¼ H:i" }})</small>
          
          <!-- ì¢‹ì•„ìš” ë²„íŠ¼ -->
          <form action="{% url 'main:like_comment' comment.pk %}" method="POST">
            {% csrf_token %}
            {% if user in comment.like_users.all %}
              <button type="submit">â¤ï¸</button>
            {% else %}
              <button type="submit">ğŸ¤</button>
            {% endif %}
            {{ comment.like_users.count }}
          </form>
  
          <!-- ëŒ€ëŒ“ê¸€ ëª©ë¡ -->
          <ul>
            {% for reply in comment.replies.all %}
              <li>
                â†³ {{ reply.author.nickname }} - {{ reply.content }}
                <small>(ì‘ì„± ì‹œê°„: {{ comment.created_at|date:"Yë…„ mì›” dì¼ H:i" }})</small>
                <!-- ëŒ€ëŒ“ê¸€ ì¢‹ì•„ìš” -->
                <form action="{% url 'main:like_comment' reply.pk %}" method="POST">
                  {% csrf_token %}
                  {% if user in reply.like_users.all %}
                    <button type="submit">â¤ï¸</button>
                  {% else %}
                    <button type="submit">ğŸ¤</button>
                  {% endif %}
                  {{ reply.like_users.count }}
                </form>
              </li>
            {% endfor %}
          </ul>
  
          <!-- ëŒ€ëŒ“ê¸€ ì‘ì„± í¼ -->
          <form action="{% url 'main:comments_create' post.pk %}" method="POST">
            {% csrf_token %}
            <input type="hidden" name="parent_id" value="{{ comment.pk }}">
            {{ comment_form }}
            <button type="submit">ë‹µê¸€ ì‘ì„±</button>
          </form>
        </li>
      {% endif %}
    {% endfor %}
  </ul>
<!-- ëŒ“ê¸€ ì¢‹ì•„ìš” ë²„íŠ¼ í…œí”Œë¦¿ì— ì¶”ê°€í•˜ê¸° ì½”ë“œ ë-->

</body>
</html>